@startuml
skinparam monochrome true
skinparam shadowing false
!theme mono

actor Passenger
participant "fleet : Fleet" as Fleet
participant "taxi : RoboTaxi" as Taxi
participant "route : Route" as Route
participant "sensor : Sensor" as Sensor
participant "pickupLoc : Location" as PickupLoc
participant "dropoffLoc : Location" as DropoffLoc

Passenger -> Fleet : dispatchVehicle(pickupLoc, dropoffLoc)
activate Fleet

Fleet -> Fleet : getAvailableVehicles()

Fleet -> Taxi : getStatus()
activate Taxi
Taxi --> Fleet : IDLE
deactivate Taxi

create Route
Fleet -> Route : new Route(routeId)
activate Route
Route --> Fleet : route
deactivate Route

Fleet -> Route : addWaypoint(pickupLoc)
activate Route
Route --> Fleet : void
deactivate Route

Fleet -> Route : addWaypoint(dropoffLoc)
activate Route
Route --> Fleet : void
deactivate Route

Fleet -> Route : optimizeRoute()
activate Route
Route -> PickupLoc : distanceTo(dropoffLoc)
activate PickupLoc
PickupLoc --> Route : Double
deactivate PickupLoc
Route --> Fleet : void
deactivate Route

Fleet -> Taxi : setRoute(route)
activate Taxi
Taxi --> Fleet : void
deactivate Taxi

Fleet --> Passenger : taxi
deactivate Fleet

loop While en route to pickup
    Taxi -> Sensor : readData()
    activate Sensor
    Sensor --> Taxi : SensorData
    deactivate Sensor
    
    Taxi -> Taxi : updateLocation(newLocation)
    
    Taxi -> Taxi : drive()
end

Taxi -> Passenger : Arrived at pickup

' --- Boarding sequence updated for consistency ---
' The Passenger's physical action triggers the Taxi to update its state
Passenger -> Taxi : (Boards vehicle)
activate Taxi
' The Taxi calls its own method, as defined in the class diagram
Taxi -> Taxi : pickupPassenger(Passenger)
Taxi --> Passenger : (Vehicle ready)
deactivate Taxi

loop While en route to dropoff
    Taxi -> Sensor : readData()
    activate Sensor
    Sensor --> Taxi : SensorData
    deactivate Sensor
    
    Taxi -> Taxi : updateLocation(newLocation)
    
    Taxi -> Taxi : drive()
    
    Taxi -> Route : getDistance()
    activate Route
    Route --> Taxi : Double
    deactivate Route
end

Taxi -> Passenger : Arrived at destination

' --- Exiting sequence updated for consistency ---
' The Passenger's physical action triggers the Taxi to update its state
Passenger -> Taxi : (Exits vehicle)
activate Taxi
' The Taxi calls its own method, passing the passenger
Taxi -> Taxi : dropoffPassenger(Passenger)
Taxi --> Passenger : (Trip complete)
deactivate Taxi

Taxi -> Fleet : Trip completed
activate Fleet
Fleet -> Taxi : setStatus(IDLE)
activate Taxi
Taxi --> Fleet : void
deactivate Taxi
deactivate Fleet

@enduml