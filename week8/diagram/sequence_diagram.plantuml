@startuml
skinparam monochrome true
skinparam shadowing false
!theme mono

actor Passenger
participant "fleet : Fleet" as Fleet
participant "taxi : RoboTaxi" as Taxi
participant "route : Route" as Route
participant "sensor : Sensor" as Sensor
participant "location : Location" as Location

Passenger -> Fleet : requestRide(pickup, dropoff)
activate Fleet

Fleet -> Fleet : getAvailableVehicles()

Fleet -> Taxi : getStatus()
activate Taxi
Taxi --> Fleet : IDLE
deactivate Taxi

Fleet -> Route : create(routeId)
activate Route
Route --> Fleet : route
deactivate Route

Fleet -> Route : addWaypoint(pickup)
activate Route
Route -> Location : create(pickup)
activate Location
deactivate Location
Route --> Fleet : void
deactivate Route

Fleet -> Route : addWaypoint(dropoff)
activate Route
Route -> Location : create(dropoff)
activate Location
deactivate Location
Route --> Fleet : void
deactivate Route

Fleet -> Route : optimizeRoute()
activate Route
Route -> Location : distanceTo(other)
activate Location
Location --> Route : Double
deactivate Location
Route --> Fleet : void
deactivate Route

Fleet -> Taxi : setRoute(route)
activate Taxi
Taxi --> Fleet : void
deactivate Taxi

Fleet --> Passenger : taxi assigned
deactivate Fleet

loop While en route to pickup
    Taxi -> Sensor : readData()
    activate Sensor
    Sensor --> Taxi : SensorData
    deactivate Sensor
    
    Taxi -> Location : create(newLat, newLon)
    activate Location
    Location --> Taxi : currentLocation
    deactivate Location
    
    Taxi -> Taxi : updateLocation(currentLocation)
end

Taxi -> Passenger : Arrived at pickup
activate Passenger

Passenger -> Taxi : boardVehicle(taxi)
activate Taxi
Taxi --> Passenger : void
deactivate Taxi

deactivate Passenger

loop While en route to dropoff
    Taxi -> Sensor : readData()
    activate Sensor
    Sensor --> Taxi : SensorData
    deactivate Sensor
    
    Taxi -> Taxi : updateLocation(currentLocation)
    
    Taxi -> Route : getDistance()
    activate Route
    Route --> Taxi : Double
    deactivate Route
end

Taxi -> Passenger : Arrived at destination
activate Passenger

Passenger -> Taxi : exitVehicle()
activate Taxi
Taxi --> Passenger : void
deactivate Taxi

deactivate Passenger

Taxi -> Taxi : completeTrip()

@enduml